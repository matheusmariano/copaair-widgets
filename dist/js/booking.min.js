!function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery"],t):t("object"==typeof exports?require("jquery"):jQuery)}(function(t){"use strict";function e(e,o){this.$booking=t(e),this.options=t.extend({},i,o),this._defaults=i,this._name=n,this.init()}var n="copaBooking",i={lang:"es",origin:"all",destination:"all",templatePath:"bower_components/copaair-widgets/templates/master.hbs",languagePath:"bower_components/copaair-widgets/language/",formUrl:"https://bookings.copaair.com/CMGS/AirLowFareSearchExternal.do?"},o={allDestinations:"https://copaapi.nbxapps.com/destinations/",countryDestinations:"https://copaapi.nbxapps.com/destinations/?country="};e.prototype.init=function(){var e=this;return t.getJSON(e.options.languagePath+e.options.lang+".json",function(t){e.languageStrings=t,e.compileTemplate(function(){e.setupSelectMenus(),e.setupAutocomplete(),e.setupDatePickers()})}),this},e.prototype.compileTemplate=function(e){var n=this;return"undefined"!=typeof Handlebars&&null!==Handlebars?t.ajax({url:n.options.templatePath,success:function(t){var e=Handlebars.compile(t),i=e(n.languageStrings);n.$booking.html(i)},complete:function(){"function"==typeof e&&e()}}):console.error("This plugin requires Handlebars.js"),this},e.prototype.setupSelectMenus=function(){return t(".js-selectmenu").selectmenu(),this},e.prototype.setupAutocomplete=function(){var t=this;return this.fetchDestinations(function(){t.buildAutocomplete(function(){console.log("boom")})}),this},e.prototype.fetchDestinations=function(e){var n=this,i=o.allDestinations,a=n.options.lang;return n.destinations=[],t.getJSON(i,function(i){i.sort(function(t,e){return t.name[a]>e.name[a]?1:t.name[a]<e.name[a]?-1:0});var o=[];t.each(i,function(t,e){var n="<b>"+e.name[a]+", "+e.country+'</b><span class="code"> | '+e.id+"</span>",i=e.id,r=e.name[a]+", "+e.id;o.push({label:n,value:i,display:r})}),n.destinations=o,"function"==typeof e&&e()}),this},e.prototype.buildAutocomplete=function(e){var n=this;return this.$booking.find(".js-booking-autocomplete").each(function(){var e=t(this).hide(),i=e.val(),o=e.attr("placeholder"),a=e.data("input-field"),r=t("<input />").val(i).attr("type","text").attr("placeholder",o);r.autocomplete({delay:0,minLength:0,source:n.destinations,select:function(e,n){return r.val(n.item.display),"origin"===a||"destination"===a?(t(".js-"+a+"-input-outbound").val(n.item.value),t(".js-"+a+"-input-inbound").val(n.item.value)):console.log("The form needs two trip type inputs: origin and destination"),!1}}),r.addClass("booking-control  booking-combobox-input").addClass("ui-widget  ui-widget-content  ui-state-default"),r.insertAfter(e),r.autocomplete("instance")._renderItem=function(e,n){return t("<li>").append(n.label).appendTo(e)},t.ui.autocomplete.filter=function(e,n){var i=new RegExp("\\b"+t.ui.autocomplete.escapeRegex(n),"i");return t.grep(e,function(t){return i.test(t.label||t.value||t)})}}),"function"==typeof e&&e(),this},e.prototype.setupDatePickers=function(){t(".booking-datepicker-departure").datepicker({minDate:new Date}),t(".booking-datepicker-return").datepicker({minDate:new Date});var e=new Date,n=new Date(e.getTime()+6048e5);return t(".booking-datepicker-departure").datepicker("setDate",e),t(".booking-datepicker-return").datepicker("setDate",n),this.defaultDates(),this},e.prototype.defaultDates=function(){var e=this.$booking,n=t(".booking-datepicker-departure").datepicker("getDate"),i=t(".booking-datepicker-return").datepicker("getDate");return e.find('input[name="inboundOption.departureDay"]').attr("value",i.getUTCDate()),e.find('input[name="inboundOption.departureMonth"]').attr("value",i.getMonth()+1),e.find('input[name="inboundOption.departureYear"]').attr("value",i.getFullYear()),e.find('input[name="outboundOption.departureDay"]').attr("value",n.getUTCDate()),e.find('input[name="outboundOption.departureMonth"]').attr("value",n.getMonth()+1),e.find('input[name="outboundOption.departureYear"]').attr("value",n.getFullYear()),this},e.prototype.bookingEvents=function(){var e=t(".booking"),n=t(".booking-datepicker-departure"),i=t(".booking-datepicker-return"),o=(t(".booking-origin"),t(".booking-destination"),function(t,n){var o=new Date(n.selectedYear,n.selectedMonth,n.selectedDay),a=new Date(o.getTime()+6048e5);i.datepicker("setDate",a),e.find('input[name="inboundOption.departureDay"]').attr("value",a.getUTCDate()),e.find('input[name="inboundOption.departureMonth"]').attr("value",a.getMonth()+1),e.find('input[name="inboundOption.departureYear"]').attr("value",a.getFullYear()),i.datepicker("option","minDate",o),e.find('input[name="outboundOption.departureDay"]').attr("value",n.selectedDay),e.find('input[name="outboundOption.departureMonth"]').attr("value",n.selectedMonth+1),e.find('input[name="outboundOption.departureYear"]').attr("value",n.selectedYear)}),a=function(t,n){e.find('input[name="inboundOption.departureDay"]').attr("value",n.selectedDay),e.find('input[name="inboundOption.departureMonth"]').attr("value",n.selectedMonth+1),e.find('input[name="inboundOption.departureYear"]').attr("value",n.selectedYear)};n.datepicker("option","onSelect",o),i.datepicker("option","onSelect",a),this.submitForm(e)},e.prototype.submitForm=function(e){var n=this;e.on("submit",function(i){i.preventDefault();var o=t(this).serialize(),a=n.options.formUrl;if(n.validationError(e))console.log("error in the form");else{var r=window.open(a+o,"_blank");r.focus()}})},t.fn[n]=function(i){return this.each(function(){t.data(this,"plugin_"+n)||t.data(this,"plugin_"+n,new e(this,i))})}});
//# sourceMappingURL=booking.min.js.map